//
// automatically generated by spin2cpp v1.03 on Wed Sep 04 18:41:35 2013
// ..\spin2cpp.exe --ccode talk.spin 
//

#include <propeller.h>
#include "VocalTract.h"

#ifdef __GNUC__
#define INLINE__ static inline
#define Yield__() __asm__ volatile( "" ::: "memory" )
#define PostEffect__(X, Y) __extension__({ int32_t tmp__ = (X); (X) = (Y); tmp__; })
#else
#define INLINE__ static
static int32_t tmp__;
#define PostEffect__(X, Y) (tmp__ = (X), (X) = (Y), tmp__)
#define Yield__()
#define waitcnt(n) _waitcnt(n)
#define locknew() _locknew()
#define lockret(i) _lockret(i)
#define lockset(i) _lockset(i)
#define lockclr(i) _lockclr(i)
#define coginit(id, code, par) _coginit((unsigned)(par)>>2, (unsigned)(code)>>2, id)
#define cognew(code, par) coginit(0x8, (code), (par))
#define cogstop(i) _cogstop(i)
#endif

INLINE__ int32_t Min__(int32_t a, int32_t b) { return a < b ? a : b; }
INLINE__ int32_t Max__(int32_t a, int32_t b) { return a > b ? a : b; }
INLINE__ int32_t Shr__(uint32_t a, uint32_t b) { return (a>>b); }
static VocalTract thisobj;
static uint8_t dat[] = {
  0x00, 0x1a, 0xfe, 0xa0, 0x0a, 0x01, 0xbc, 0x80, 0x00, 0x18, 0xfe, 0xe4, 0x1e, 0x48, 0xfe, 0xa0, 
  0xd4, 0x9a, 0xbe, 0xa0, 0x0b, 0x09, 0xbc, 0x80, 0x01, 0x48, 0x7e, 0x61, 0x02, 0x08, 0xf0, 0x84, 
  0x04, 0x48, 0xfe, 0xe4, 0xc6, 0xd6, 0xbe, 0xa0, 0x0d, 0x48, 0xfe, 0xa0, 0x08, 0x4a, 0xfe, 0xa0, 
  0xe9, 0xd8, 0xbe, 0xa0, 0x0b, 0x19, 0xbc, 0x80, 0x0c, 0x4a, 0xfe, 0xe4, 0x08, 0x18, 0xfc, 0x84, 
  0x01, 0xd6, 0xfd, 0x80, 0x01, 0xda, 0xfd, 0x80, 0x01, 0xe0, 0xfd, 0x80, 0x0b, 0x48, 0xfe, 0xe4, 
  0xc6, 0xa6, 0xbf, 0xa0, 0xf0, 0x49, 0xbe, 0xa0, 0x08, 0x48, 0xfe, 0x80, 0x04, 0x4a, 0xfe, 0xa0, 
  0x24, 0xed, 0xbf, 0x08, 0x04, 0x48, 0xfe, 0x80, 0x0a, 0x31, 0xbc, 0x80, 0x18, 0x4a, 0xfe, 0xe4, 
  0x24, 0x1b, 0xbe, 0x08, 0x04, 0x48, 0xfe, 0x80, 0x24, 0x1d, 0xbe, 0x08, 0xf1, 0x1f, 0xbe, 0xa0, 
  0x0e, 0x1f, 0xbe, 0x80, 0x0e, 0x1f, 0xbe, 0xf8, 0xf0, 0x49, 0xbe, 0x08, 0x24, 0x45, 0xbe, 0x38, 
  0x22, 0x49, 0xbe, 0xa0, 0x0a, 0x48, 0xfe, 0x38, 0x0d, 0x49, 0xbe, 0x80, 0x24, 0xf5, 0xbf, 0xa0, 
  0x22, 0x49, 0xbe, 0xa0, 0x00, 0x49, 0xbe, 0x80, 0x24, 0xf7, 0xbf, 0xa0, 0xf0, 0x49, 0xbe, 0xa0, 
  0x04, 0x48, 0xfe, 0x80, 0x24, 0x45, 0x3e, 0x08, 0xf3, 0xe4, 0x3d, 0x61, 0x01, 0xe4, 0xfd, 0x34, 
  0xf3, 0xe4, 0x3d, 0x61, 0x01, 0xe4, 0xfd, 0x34, 0xf3, 0xe4, 0x3d, 0x61, 0x01, 0xe4, 0xfd, 0x34, 
  0x26, 0x49, 0xbe, 0xa0, 0xf2, 0x4a, 0xbe, 0xa0, 0xd0, 0xd6, 0xfe, 0x5c, 0x08, 0x48, 0xfe, 0x38, 
  0x24, 0x45, 0xbe, 0xa0, 0x2a, 0x49, 0xbe, 0xa0, 0x0a, 0x48, 0xfe, 0x28, 0x24, 0x2b, 0xbe, 0x80, 
  0x29, 0x49, 0xbe, 0xa0, 0x15, 0x4b, 0xbe, 0xa0, 0xc7, 0xd6, 0xfe, 0x5c, 0x28, 0x49, 0xbe, 0x80, 
  0x02, 0x48, 0xfe, 0x28, 0x24, 0x4b, 0xbe, 0xa0, 0x02, 0x4a, 0xfe, 0x28, 0x25, 0x49, 0xbe, 0x80, 
  0x24, 0x4b, 0xbe, 0xa0, 0x04, 0x4a, 0xfe, 0x28, 0x25, 0x49, 0xbe, 0x80, 0x24, 0x4b, 0xbe, 0xa0, 
  0x08, 0x4a, 0xfe, 0x28, 0x25, 0x49, 0xbe, 0x80, 0xf1, 0x48, 0xbe, 0x80, 0xbe, 0x8c, 0xfd, 0x5c, 
  0x25, 0x2d, 0xbe, 0x80, 0x16, 0x49, 0xbe, 0xa0, 0xbe, 0x8c, 0xfd, 0x5c, 0x01, 0x4b, 0xbe, 0x84, 
  0x27, 0x49, 0xbe, 0xa0, 0xc7, 0xd6, 0xfe, 0x5c, 0x06, 0x48, 0xfe, 0x38, 0x24, 0x45, 0xbe, 0x80, 
  0x00, 0x46, 0xfe, 0xa0, 0x2b, 0x43, 0xbe, 0xa0, 0x18, 0x45, 0xbe, 0x80, 0x19, 0x47, 0xbe, 0x80, 
  0xd6, 0xa6, 0xff, 0x5c, 0x22, 0x31, 0xbe, 0xa0, 0x23, 0x33, 0xbe, 0xa0, 0x2c, 0x43, 0xbe, 0xa0, 
  0x1a, 0x45, 0xbe, 0x80, 0x1b, 0x47, 0xbe, 0x80, 0xd6, 0xa6, 0xff, 0x5c, 0x22, 0x35, 0xbe, 0xa0, 
  0x23, 0x37, 0xbe, 0xa0, 0x2d, 0x43, 0xbe, 0xa0, 0x1c, 0x45, 0xbe, 0x80, 0x1d, 0x47, 0xbe, 0x80, 
  0xd6, 0xa6, 0xff, 0x5c, 0x22, 0x39, 0xbe, 0xa0, 0x23, 0x3b, 0xbe, 0xa0, 0x2e, 0x43, 0xbe, 0xa0, 
  0x1e, 0x45, 0xbe, 0x80, 0x1f, 0x47, 0xbe, 0x80, 0xd6, 0xa6, 0xff, 0x5c, 0x22, 0x3d, 0xbe, 0xa0, 
  0x23, 0x3f, 0xbe, 0xa0, 0x22, 0x41, 0xbe, 0x80, 0x30, 0x43, 0xbe, 0xa0, 0xd6, 0xa6, 0xff, 0x5c, 
  0x2f, 0x49, 0xbe, 0xa0, 0x22, 0x4b, 0xbe, 0xa0, 0xd0, 0xd6, 0xfe, 0x5c, 0x20, 0x45, 0xbe, 0xa0, 
  0x24, 0x41, 0xbe, 0xa4, 0xf2, 0x48, 0xbe, 0xa0, 0x03, 0x48, 0xfe, 0x38, 0x24, 0x2f, 0xbe, 0x80, 
  0x01, 0x48, 0xfe, 0x38, 0x24, 0x2f, 0xbe, 0x80, 0x32, 0x49, 0xbe, 0xa0, 0x01, 0x48, 0xfe, 0x28, 
  0x24, 0x2f, 0xbe, 0x80, 0x31, 0x49, 0xbe, 0xa0, 0x17, 0x4b, 0xbe, 0xa0, 0xc7, 0xd6, 0xfe, 0x5c, 
  0x24, 0x45, 0xbe, 0x80, 0x82, 0x00, 0x3c, 0x5c, 0x83, 0x00, 0x00, 0x00, 0x21, 0x04, 0xfd, 0x5c, 
  0xf0, 0x23, 0xbe, 0xa0, 0x20, 0x22, 0xfe, 0x80, 0x10, 0x23, 0xbe, 0x80, 0x11, 0x27, 0xbe, 0x08, 
  0x03, 0x27, 0xbe, 0x62, 0x91, 0x00, 0x54, 0x5c, 0xbc, 0x1a, 0xbd, 0xa0, 0x0d, 0x24, 0xfe, 0xa0, 
  0x21, 0x04, 0xfd, 0x5c, 0x33, 0x4d, 0xbe, 0xa0, 0x0b, 0x1b, 0xbd, 0x80, 0x8c, 0x24, 0xfe, 0xe4, 
  0x83, 0x00, 0x7c, 0x5c, 0x01, 0x26, 0xfe, 0x80, 0x13, 0x29, 0xbe, 0xa0, 0x33, 0x39, 0xfd, 0x50, 
  0x26, 0x3b, 0xfd, 0x54, 0x33, 0x3d, 0xfd, 0x54, 0x40, 0x4d, 0xfd, 0x54, 0x03, 0x22, 0xfe, 0x80, 
  0x0d, 0x24, 0xfe, 0xa0, 0x21, 0x04, 0xfd, 0x5c, 0x11, 0x49, 0xbe, 0x00, 0x18, 0x48, 0xfe, 0x2c, 
  0x33, 0x4b, 0xbe, 0xa0, 0x25, 0x4d, 0xbe, 0xa0, 0x24, 0x67, 0xbe, 0xa0, 0x25, 0x49, 0xbe, 0x85, 
  0x24, 0x49, 0xbe, 0xb0, 0x01, 0xfe, 0x7f, 0x36, 0x08, 0x4a, 0xfe, 0xa0, 0x01, 0x48, 0xfe, 0x2d, 
  0x13, 0x49, 0xb2, 0x80, 0xa3, 0x4a, 0xfe, 0xe4, 0x24, 0x81, 0xbe, 0xbc, 0x01, 0x38, 0xfd, 0x80, 
  0x0a, 0x3b, 0xbd, 0x80, 0x0a, 0x3d, 0xbd, 0x80, 0x0a, 0x4d, 0xbd, 0x80, 0x01, 0x22, 0xfe, 0x80, 
  0x99, 0x24, 0xfe, 0xe4, 0x21, 0x04, 0xfd, 0x5c, 0xbd, 0x62, 0xbd, 0xa0, 0x0d, 0x24, 0xfe, 0xa0, 
  0x21, 0x04, 0xfd, 0x5c, 0x40, 0x4d, 0xbe, 0x80, 0x0b, 0x63, 0xbd, 0x80, 0xb0, 0x24, 0xfe, 0xe4, 
  0x13, 0x29, 0xbe, 0x80, 0x02, 0x29, 0x3e, 0x61, 0xad, 0x00, 0x4c, 0x5c, 0x10, 0x22, 0xfe, 0x84, 
  0x11, 0xff, 0x3f, 0x08, 0x10, 0x20, 0xfe, 0x80, 0x7f, 0x20, 0xfe, 0x60, 0x83, 0x00, 0x7c, 0x5c, 
  0x33, 0x4d, 0xbe, 0xa0, 0x40, 0x4d, 0xbe, 0x80, 0x24, 0x4b, 0xbe, 0xa0, 0x10, 0x4a, 0xfe, 0x28, 
  0x1c, 0x48, 0xfe, 0x28, 0x08, 0x4b, 0xbe, 0x60, 0x05, 0x4b, 0xbe, 0x68, 0x25, 0x4b, 0xbe, 0x04, 
  0x04, 0x4b, 0xbe, 0x68, 0x24, 0x4b, 0xbe, 0x2c, 0x00, 0x00, 0x7c, 0x5c, 0x13, 0x4a, 0xfe, 0x28, 
  0x07, 0x4b, 0x3e, 0x62, 0x09, 0x4b, 0x3e, 0x61, 0x25, 0x4b, 0xbe, 0xb0, 0x06, 0x4b, 0xbe, 0x68, 
  0x01, 0x4a, 0xfe, 0x2c, 0x25, 0x4b, 0xbe, 0x04, 0x25, 0x4b, 0xbe, 0xbc, 0x0f, 0x4a, 0xfe, 0x2c, 
  0x11, 0x48, 0xfe, 0x28, 0x0f, 0x4a, 0xfe, 0x38, 0x0e, 0x4a, 0xfe, 0x2c, 0x4d, 0x01, 0x7c, 0x5c, 
  0x01, 0x48, 0xfe, 0x39, 0x25, 0x49, 0xb2, 0x80, 0x01, 0x44, 0xfe, 0x38, 0x22, 0x49, 0xbe, 0xa0, 
  0x03, 0x48, 0xfe, 0x38, 0x24, 0x45, 0xbe, 0x80, 0x22, 0x49, 0xbe, 0xa0, 0x04, 0x48, 0xfe, 0x38, 
  0x24, 0x45, 0xbe, 0x80, 0x01, 0x46, 0xfe, 0x38, 0x23, 0x49, 0xbe, 0xa0, 0x03, 0x48, 0xfe, 0x38, 
  0x24, 0x47, 0xbe, 0x80, 0x23, 0x49, 0xbe, 0xa0, 0x04, 0x48, 0xfe, 0x38, 0x24, 0x47, 0xbe, 0x80, 
  0x22, 0x49, 0xbe, 0xa0, 0x23, 0x45, 0xbe, 0x84, 0x24, 0x47, 0xbe, 0x80, 0x00, 0x43, 0xbe, 0x85, 
  0x6d, 0x01, 0x7c, 0x5c, 0x21, 0x43, 0xbe, 0xa1, 0x23, 0x49, 0xbe, 0xa0, 0x01, 0x48, 0xfe, 0x38, 
  0x22, 0x4b, 0xbe, 0xa0, 0x01, 0x4a, 0xfe, 0x38, 0x24, 0x45, 0xbe, 0x94, 0x25, 0x47, 0xbe, 0x90, 
  0xf4, 0x42, 0xbe, 0x94, 0x00, 0x00, 0x92, 0x66, 0x01, 0x00, 0x00, 0x00, 0x00, 0x10, 0x06, 0x80, 
  0x76, 0x14, 0x90, 0x4b, 0x6d, 0xe1, 0xec, 0x27, 0x50, 0x47, 0x44, 0x14, 0x0c, 0x35, 0x2c, 0x0a, 
  0x85, 0x5f, 0x17, 0x05, 0x79, 0xd8, 0x8b, 0x02, 0x54, 0xf1, 0x45, 0x01, 0x4d, 0xf9, 0xa2, 0x00, 
  0xbb, 0x7c, 0x51, 0x00, 0x60, 0xbe, 0x28, 0x00, 0x30, 0x5f, 0x14, 0x00, 0x98, 0x2f, 0x0a, 0x00, 
  0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0x00, 
  0x00, 0x00, 0x01, 0x00, 0x00, 0xd0, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 
  0xfe, 0x0f, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x01, 0x02, 0x00, 0x00, 
  0xe3, 0x00, 0x00, 0x00, 
};
int32_t VocalTract_Start(int32_t Tract_ptr, int32_t Pos_pin, int32_t Neg_pin, int32_t Fm_offset)
{
  VocalTract_Stop();
  thisobj.Tract = Tract_ptr;
  thisobj.Pace = 100;
  if (Pos_pin > (-1)) {
    (&thisobj.Dira_)[((Shr__(Pos_pin, 5)) & 0x1)] = ((&thisobj.Dira_)[((Shr__(Pos_pin, 5)) & 0x1)] | ((1<<Pos_pin)));
    thisobj.Ctrb_ = (402653184 + (Pos_pin & 0x3f));
    if (Neg_pin > (-1)) {
      (&thisobj.Dira_)[((Shr__(Neg_pin, 5)) & 0x1)] = ((&thisobj.Dira_)[((Shr__(Neg_pin, 5)) & 0x1)] | ((1<<Neg_pin)));
      thisobj.Ctrb_ = (thisobj.Ctrb_ + (67108864 + ((Neg_pin & 0x3f) << 9)));
    }
  }
  if (Fm_offset > (-1)) {
    thisobj.Ctra_ = 92274688;
  }
  {
    int32_t _idx__0001;
    for(_idx__0001 = 1; _idx__0001 <= 33; (_idx__0001 = (_idx__0001 + 1))) {
      thisobj.Frqa_ = (thisobj.Frqa_ << 1);
      if (Fm_offset >= CLKFREQ) {
        Fm_offset = (Fm_offset - CLKFREQ);
        (thisobj.Frqa_++);
      }
      Fm_offset = (Fm_offset << 1);
    }
  }
  thisobj.Cnt_ = (CLKFREQ / 20000);
  return (thisobj.Cog = (cognew((int32_t)(&(*(int32_t *)&dat[0])), (int32_t)(&thisobj.Attenuation)) + 1));
}

int32_t VocalTract_Stop(void)
{
  if (thisobj.Cog) {
    cogstop((PostEffect__(thisobj.Cog, 0) - 1));
  }
  { int32_t _fill__0002; int32_t *_ptr__0004 = (int32_t *)&thisobj.Index; int32_t _val__0003 = 0; for (_fill__0002 = 0x29; _fill__0002 > 0; --_fill__0002) {  *_ptr__0004++ = _val__0003; } };
  return 0;
}

int32_t VocalTract_Set_attenuation(int32_t Level)
{
  thisobj.Attenuation = Level;
  return 0;
}

int32_t VocalTract_Set_pace(int32_t Percentage)
{
  thisobj.Pace = Percentage;
  return 0;
}

int32_t VocalTract_Go(int32_t Time)
{
  while (thisobj.Frames[thisobj.Index]) {
    Yield__();
  }
  memcpy( (void *)(void *)(((int32_t)(&thisobj.Frames[thisobj.Index]) + 3)), (void *)thisobj.Tract, 1*(13));
  thisobj.Frames[thisobj.Index] = (thisobj.Frames[thisobj.Index] | (16777216 / (Max__(((Time * 100) / thisobj.Pace), 2))));
  thisobj.Index = ((thisobj.Index + Frame_longs) & 0x1f);
  return 0;
}

int32_t VocalTract_Full(void)
{
  return thisobj.Frames[thisobj.Index];
}

int32_t VocalTract_Empty(void)
{
  int32_t	I;
  int32_t Status = 0;
  I = 0;
  do {
    if (thisobj.Frames[(I * Frame_longs)]) {
      return Status;
    }
    I = (I + 1);
  } while (I <= 7);
  return -1;
}

int32_t VocalTract_Sample_ptr(void)
{
  return (int32_t)(&thisobj.Sample);
}

int32_t VocalTract_Aural_id(void)
{
  return (thisobj.Cog - 1);
}

